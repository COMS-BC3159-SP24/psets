\documentclass[]{article}

% add math
\usepackage{amssymb,amsmath}

% add nice links and colors
\usepackage{xcolor}
\usepackage[unicode=true]{hyperref}
\hypersetup{pdfborder={0 0 0},breaklinks=true,bookmarks=true,colorlinks=true}

% for algorithms and code
\usepackage{listings}
\lstnewenvironment{itemlisting}[1][]
 {%
  \mbox{}
  \vspace*{-\baselineskip}
  \lstset{
    xleftmargin=\leftmargin,
    linewidth=\linewidth,
    #1
  }%
 }
 {}
\lstset
{ %Formatting for code in appendix
    language=C++,
    %basicstyle=\footnotesize,
    numbers=left,
    stepnumber=1,
    showstringspaces=false,
    %tabsize=1,
    breaklines=true,
    breakatwhitespace=false,
}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\newcommand{\setalglineno}[1]{%
  \setcounter{ALG@line}{\numexpr#1-1}}
\makeatletter
\newcommand\fs@spaceruled{\def\@fs@cfont{\bfseries}\let\@fs@capt\floatc@ruled
  \def\@fs@pre{\vspace{0.4\baselineskip}\hrule height.8pt depth0pt \kern2pt}%
  \def\@fs@post{\vspace{-0.4\baselineskip}\kern2pt\hrule\relax\vspace{-12pt}}%
  \def\@fs@mid{\kern2pt\hrule\kern2pt}%
  \let\@fs@iftopcapt\iftrue}
\makeatother

% some basic paragraph styling
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
\usepackage{setspace}
\usepackage{enumitem}

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% custom commands
% if you want to leave a \todo{I need to finish this} reminder!
\newcommand{\todo}[1]{\textbf{\textcolor{red}{#1}}}

% title and author
\title{COMS BC 3159 - S24: Problem Set 2}
\author{
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                                       %
    % TODO: Your Name Here                  %
    %                                       %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
}
\date{}

\begin{document}

\maketitle

\textbf{Introduction:}  
The following exercises will continue to explore GPU programming and begin to explore numerical optimization.

Finally, we'd like to remind you that all work should be yours and yours alone. This being said, in addition to being able to ask questions at office hours, you are allowed to discuss questions with fellow classmates, provided 1) you note the people with whom you collaborated, and 2) you \textbf{DO NOT} copy any answers. Please write up the solutions to all problems independently.

Without further ado, let's jump right in!

\bigskip
\textbf{Collaborators:}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                       %
% TODO: Names of any Collaborators Here %
%                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\\
\textbf{AI Tool Disclosure:}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                       %
% TODO: How did you use AI tools?       %
%                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Problem 1 (4 Points):}
For the following questions please indicate if the statement is true or false and then explain your answer in 1-3 sentences.
\begin{enumerate}[label=(\alph*)]
    \item Gradient descent will always find a global minima.
    \item The critical points of a function are where the first derivative (or gradient) of that function is equal to zero. These points are guaranteed to be local minima or maxima.
    \item If a function is convex then the line segment connecting two points on the graph of $f$ always lies above the graph of $f$.
    \item Practical gradient descent methods often do not apply the full gradient update at each iteration.
\end{enumerate}

\textbf{Solution 1:}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TODO: Your solution to Problem 1      %
%       Note you can use $\blacksquare$ %
%       to fill in true or false!       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{enumerate}[label=(\alph*)]
    \item $\Box$ True \quad \quad $\Box$ False \\
          % Explanation of 1a
          
    \item $\Box$ True \quad \quad $\Box$ False \\
          % Explanation of 1b
          
    \item $\Box$ True \quad \quad $\Box$ False \\
          % Explanation of 1c
          
    \item $\Box$ True \quad \quad $\Box$ False \\
          % Explanation of 1d
          
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\subsection*{Problem 2 (8 Points):}
For this problem we are going to work with the function:
$$y(x) = \frac{3}{2e}(ex-e)^2 - e^x$$
\begin{enumerate}[label=(\alph*)]
    \item (3 points) Compute a quadratic approximation $\tilde{y}(x)$ of the function at the point $x=1$ through the use of a Taylor expansion. Please show your work. You do not need to simplify your answer completely.
    \item (2 points) What are the critical point(s) of the approximation you computed in part a? Please show your work.
    \item (1 point) What are the critical point(s) of the original function?  Note: You do not need to solve this by hand but explain what you did.
    \item (2 points) Are the critical points the same or different? Why or why not? Please explain in 1-3 sentences.
\end{enumerate}

\textbf{Solution 2:}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                       %
% TODO: Your solution to Problem 2      %
%                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{enumerate}[label=(\alph*)]
    \item % Your answer to part a
          
    \item % Your answer to part b
        
    \item % Your answer to part c
    
    \item % Your answer to part d
    
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\subsection*{Problem 3 (12 Points):}
For this problem we are going to work with the function:
$$y(x) = x^4 - 3x^2 + 2x$$
Note: You do not need to solve this by hand but explain what you did in each step (do not just write down the final answer).
\begin{enumerate}[label=(\alph*)]
    \item (2 points) What are the critical points of this function?
    \item (2 points) Compute one step of gradient descent starting from $x=-2$ with $\alpha = 0.025$. Where do you end up?
    \item (1 point) Based on that step do you think $\alpha = 0.025$ was a good choice? If you were to do it again would you leave it the same? Increase it? Decrease it?
    \item (2 points) Starting at the point computed by part b, take one more step of gradient descent this time using $\alpha = 0.1$. Where do you end up?
    \item (1 point) Based on that step do you think $\alpha = 0.1$ was a good choice? If you were to do it again would you leave it the same? Increase it? Decrease it?
    \item (3 points) Now assume you are starting again from $x=-2$ and now doing gradient descent with a backtracking line search starting with $\alpha = 1$ and updating $\alpha = \alpha / 2$ on every backtracking step. With what value of $\alpha$ will the \textit{first} step occur under the cost function $J(x) = (x - nearest\_local\_min)^2$ where $nearest\_local\_min$ is (one of) your value(s) computed in part a? Where will that take you?
    \item (1 point) Based on everything you have explored in this problem, do you think that resulting $\alpha$ from part f was a good choice? If you were to do it again would you leave it the same? Increase it? Decrease it?
\end{enumerate}

\clearpage
\textbf{Solution 3:}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                       %
% TODO: Your solution to Problem 3      %
%                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{enumerate}[label=(\alph*)]
    \item % Your answer to part a
    
    \item % Your answer to part b
    
    \item % Your answer to part c
    
    \item % Your answer to part d
    
    \item % Your answer to part e
    
    \item % Your answer to part f
    
    \item % Your answer to part g
    
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\subsection*{Problem 4 (8 Points)}
Below you will find multiple different examples of GPU kernels designed to add one to the input array in parallel. For this question please assume that the input array is of length 128 and the host code was done correctly. That is, \texttt{N=128} and \texttt{d\_data} was correctly allocated on the GPU to be that length. For each kernel indicate ALL of the kernel launch configurations that will produce the correct output. If none are correct please specify what configuration would work!
Launch configuration options are:
\begin{enumerate}[label=\roman*]
    \item \texttt{increment\_kernel<<<1,1,0,0>>>(d\_data,128);}
    \item \texttt{increment\_kernel<<<1,128,0,0>>>(d\_data,128);}
    \item \texttt{increment\_kernel<<<1,256,128*sizeof(int),0>>>(d\_data,128);}
    \item \texttt{dim3 tDims(128,128);} \\ \texttt{increment\_kernel<<<1,tDims,0,0>>>(d\_data,128);}
    \item \texttt{dim3 bDims(128,128); tDims(128,128);} \\ \texttt{increment\_kernel<<<bDims,tDims,0,0>>>(d\_data,128);}
    \item None of the above (please specify the correct configuration)
\end{enumerate}

\subsubsection*{Kernel (a)}
\begin{lstlisting}
__global__
void increment_kernel(int *d_data, int N) {
    if (threadIdx.x < N) {
        d_data[threadIdx.x] += 1;
    }
}
\end{lstlisting}

\subsubsection*{Kernel (b)}
\begin{lstlisting}
__global__
void increment_kernel(int *d_data, int N) {
    for (int i = threadIdx.x; i < N; i += blockDim.x) {
        d_data[i] += 1;
    }
}
\end{lstlisting}

\subsubsection*{Kernel (c)}
\begin{lstlisting}
__global__
void increment_kernel(int *d_data, int N) {
    d_data[threadIdx.x] += 1;
}
\end{lstlisting}

\subsubsection*{Kernel (d)}
{\small
\begin{lstlisting}
__global__
void increment_kernel(int *d_data, int N) {
  int thread_rank = threadIdx.x + blockDim.x*threadIdx.y;
  int threads_per_block = blockDim.x*blockDim.y;
  int block_rank = blockIdx.x + gridDim.x*blockIdx.y;
  int blocks_per_grid = gridDim.x*gridDim.y;
  int grid_rank = thread_rank + block_rank*threads_per_block;
  int threads_per_grid = threads_per_block*blocks_per_grid;
  for (int i = grid_rank; i < N; i += threads_per_grid) {
    d_data[i] += 1;
  }
}
\end{lstlisting}}
\textbf{Solution 4:}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                       %
% TODO: Your solution to Problem 4      %
%                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{enumerate}[label=(\alph*)]
    \item 
    \item 
    \item 
    \item 
\end{enumerate}

\end{document}